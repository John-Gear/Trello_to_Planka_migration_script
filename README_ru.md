# Trello to Planka Migration Script

## Описание
Этот скрипт предназначен для переноса данных из Trello в Planka. Он автоматически переносит рабочие пространства, доски, списки, карточки, комментарии, вложения, метки и обложки карточек из Trello в Planka, сохраняя структуру и важную информацию.

---

## Возможности
- Перенос рабочих пространств из Trello как проектов в Planka.
- Перенос досок и списков Trello в Planka.
- Перенос карточек Trello в Planka с сохранением статуса выполнения.
- Перенос подзадач из карточек Trello в Planka.
- Перенос комментариев с указанием автора, даты и времени создания.
- Перенос вложений с добавлением даты создания в их название.
- Перевод названий вложений в латиницу.
- Перенос меток и обложек карточек.
- Логирование всех действий и ошибок в log.txt.
- Подсчет количества перенесенных элементов.

---

## Состав проекта
- `config.py` — содержит авторизационные данные Trello и Planka.
- `labels_planka.py` — сопоставление цветовых меток.
- `main.py` — точка входа в программу (запуск `python main.py`).
- `migrators.py` — основные функции миграции.
- `planka_api.py` — взаимодействие с API Planka.
- `trello_api.py` — взаимодействие с API Trello.
- `utils.py` — вспомогательные функции (логирование, контроль токенов и т. д.).

---

## Установка и запуск
1. **Создайте папку на сервере** и склонируйте репозиторий:
   ```sh
   git clone https://github.com/garpastyls/Trello_downloader.git
   ```
2. **Создайте виртуальное окружение**:
   ```sh
   python3.11 -m venv venv
   ```
3. **Активируйте окружение**:
   ```sh
   source venv/bin/activate
   ```
4. **Установите зависимости**:
   ```sh
   pip install -r requirements.txt
   ```
5. **Настройте `config.py`**, добавив ключи API Trello и Planka (см. ниже).
6. **Запустите скрипт**:
   ```sh
   python main.py
   ```
7. **Проверьте log.txt** после завершения работы.

---

## Получение API-ключа и токена Trello
1. Перейдите в [Trello Power-Ups](https://trello.com/power-ups/admin).
2. Нажмите "Улучшения" → "Создать новое".
3. Введите данные организации.
4. Нажмите "Сгенерировать новый API-ключ" и сохраните его в `config.py`.
5. Нажмите "Сгенерировать токен вручную" и разрешите доступ. Сохраните токен в `config.py`.

---

## Конфигурация (`config.py`)
```python
# Данные авторизации в Planka
PLANKA_URL = "https://planka.com/api"  # /api обязательно
USERNAME = "admin"
PASSWORD = "admin"

# Данные авторизации в Trello
TRELLO_URL = "https://api.trello.com/1/"
APIKEY = "your_trello_api_key"
APITOKEN = "your_trello_api_token"
```

---

## Зависимости
Список необходимых библиотек находится в `requirements.txt`:
```txt
requests
unidecode
datetime
pytz
tqdm
```
> **Примечание:** `urllib.parse`, `os`, `time` входят в стандартную библиотеку Python.

---

## Особенности работы
- В комментариях добавляется подпись:  
  `"Imported comment from Trello, originally posted by [Автор] [Юзернейм] [Дата]"`
- В названии вложений добавляется дата создания (`created_at_16-12-2024_13-18`).
- В `planka_api.py` можно сменить часовой пояс (`Europe/Moscow`).
- По умолчанию задержка между запросами — `0.25 сек` (можно уменьшить до `0.1 сек`).

---

## Возможные проблемы и ошибки
- **Ошибка загрузки в Planka `413 Client Error: Request Entity Too Large`**  
  Решение: Увеличьте `client_max_body_size` в конфигурации `nginx`.
- **Фоны досок из Trello не переносятся в Planka**  
  В Planka фон устанавливается на проект, а не на доску.
- **Изображения в комментариях могут не отображаться**  
  Вложения переносятся, но Planka не поддерживает вставку изображений в текст комментария.
- **Вложения-ссылки не переносятся**  
  В Trello можно прикреплять ссылки в качестве вложений, но в Planka это не поддерживается.
- **Копированные карточки могут потерять комментарии**  
  Это баг Trello: при копировании карточки комментарии не дублируются.

---

## Не реализовано
- **Перенос участников**  
- **Перенос архивных элементов (карточки, доски)**  

---

## Лицензия
Проект распространяется под лицензией **MIT**.

---

## Завершение работы
После успешной миграции в `log.txt` появится отчет:
```sh
Миграция завершена!
Всего рабочих пространств: 2 найдено в Trello, 2 перенесено в Planka
Всего досок: 11 найдено в Trello, 11 перенесено в Planka
...
```
Если числа не совпадают, найдите ошибки в `log.txt` по ключевому слову "Error".

---

### Если у вас есть вопросы или проблемы — создавайте issue в репозитории!

